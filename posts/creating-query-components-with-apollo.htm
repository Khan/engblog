<!DOCTYPE html> <html> <head> <title>Creating Query Components with Apollo | Khan Academy Engineering</title> <link rel="icon" href="/images/favicon.ico"> <meta http-equiv="Content-Type" content="text/html;charset=utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="description" content="We're the engineers behind Khan Academy. We're building a free, world-class education for anyone, anywhere.">  <style>#left-bar,#left-bar .logo a{color:#f0f0f0}#left-bar .bio a,#left-bar .logo a{text-decoration:none}#left-bar .logo,#left-bar .subscription-info{text-align:left}.caption,caption,figcaption{font-style:italic}body,html{height:100%;margin:0}body{font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;background-color:#FEFEFE;font-size:14px;width:920px}@media (min-width:920px){body{font-size:16px}}@media (max-width:920px){body{width:100%}body.mobile-menu-visible{background-color:#252F3D}}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}.inline-author-photo{height:1.6em;width:1.6em;border-radius:.8em;vertical-align:middle;margin-right:4px}.font-awesome-svg{width:1em;height:1em;display:inline-block}#left-bar{box-sizing:border-box;display:table-cell;background-color:#252F3D;width:325px;padding:10px 35px 35px}@media (max-width:920px){#left-bar{display:block;width:100%;padding:0 20px}#left-bar.mobile-visible{padding-bottom:60px}#left-bar:not(.mobile-visible) section{display:none}}#left-bar .logo{font-family:"Arial Black","Arial Bold",Gadget,sans-serif;font-size:28px;letter-spacing:1px;line-height:1em;margin-bottom:6px;margin-left:-2px;margin-top:0;text-transform:uppercase}#left-bar .logo.mobile{font-size:24px;display:none}@media (max-width:920px){#left-bar .logo.mobile{display:block}#left-bar .logo.mobile a{padding:11px 20px 15px;margin:0 -20px -15px;display:block;text-decoration:none;color:#f0f0f0}#left-bar .logo.mobile svg{opacity:.8;margin-right:-2px;margin-top:1px;height:25px}#left-bar .logo.mobile .text,#left-bar .logo.mobile svg{vertical-align:middle}#left-bar .logo{display:none}}#left-bar .logo .engineering{color:#9cb53b}#left-bar .bio{font-size:12px;line-height:1.4;margin-top:10px}#left-bar .bio,#left-bar .bio *{color:#dbdcde}#left-bar .bio a:hover{text-decoration:underline}#left-bar .subscription-info .links{font-size:24px}#left-bar .subscription-info .links a{margin-right:7px;text-decoration:none;color:#f0f0f0}#left-bar .subscription-info .links a:hover{border-bottom:1px solid #f0f0f0}#left-bar .subscription-info .links .email{margin-top:-1px}#left-bar .section-heading{color:#dbdcde;font-size:12px;font-weight:300;letter-spacing:.5px;margin-top:40px;text-transform:lowercase}#left-bar .post-blurb{margin-top:30px;padding-bottom:4px;border-left:1px solid transparent;padding-left:10px;margin-left:-10px;font-size:14px}@media (max-width:920px){#left-bar .post-blurb{border-left:10px solid transparent;padding-left:17px;margin-left:-26px}}#left-bar .post-blurb:first-of-type{margin-top:20px}#left-bar .post-blurb.team-infrastructure{border-color:#E57281}#left-bar .post-blurb.team-web-frontend{border-color:#63BBD9}#left-bar .post-blurb.team-mobile{border-color:#63BB81}#left-bar .post-blurb.team-eng-leads{border-color:#ccc}#left-bar .post-blurb.team-design{border-color:#ab59c6}#left-bar .post-blurb.team-wtf{border-color:#ff00af}#left-bar .post-blurb .title{font-weight:400;margin:0 0 9px}#left-bar .post-blurb .title a{color:#f0f0f0;text-decoration:none}#left-bar .post-blurb .title a:hover{text-decoration:underline}#left-bar .post-blurb .info{font-size:12px}#left-bar .post-blurb .info .author-link{color:#f0f0f0;text-decoration:none;font-weight:700;font-size:11px}#left-bar .post-blurb .info .author-link:hover{text-decoration:underline}#left-bar .meta-section .link-list{margin:0 0 0 4px;padding:0;list-style-type:square}#left-bar .meta-section .link-list li{margin-bottom:10px}#left-bar .meta-section .link-list li a{margin-left:-4px}#left-bar .meta-section .link-list a{color:#f0f0f0;text-decoration:none}#left-bar .meta-section .link-list a:hover{text-decoration:underline}#content{display:table-cell;padding:10px 35px 35px 50px;color:#404040}@media (max-width:920px){#left-bar .meta-section .link-list{list-style-type:none}#content{padding:10px 20px 50px;display:block}#content.mobile-hidden{display:none}}#content .title a{letter-spacing:1px;margin-bottom:8px;font-size:1.265625em;line-height:1;color:#404040;text-decoration:none}@media (min-width:920px){#content .title a{font-size:1.5625em}}#content .title a:focus,#content .title a:hover{text-decoration:underline}#content .info .author-link{color:#404040;font-weight:700;text-decoration:none}#content .info .author-link:hover{text-decoration:underline}#content .info .team-tag{border-radius:.3em;padding:.3em .8em;font-size:.7em;font-weight:500;display:inline-block;color:#fff;margin-left:4px;margin-right:4px}#content .info .team-tag.web-frontend{background-color:#63BBD9}#content .body{margin-top:30px;line-height:1.5;width:580px}@media (max-width:920px){#content .body{width:100%}}#content .body a{color:#6c7d28;text-decoration:none}#content .body a:hover{text-decoration:underline}#content .body img{max-width:100%}#content .keep-reading-buttons{display:table;margin-top:30px;width:100%}#content .keep-reading-buttons .keep-reading-cell{display:table-cell;margin:0;padding:0;vertical-align:top;width:50%}progress,sub,sup{vertical-align:baseline}#content .keep-reading-buttons .keep-reading-right{text-align:right}#content .keep-reading-buttons .button{padding:3px 0;display:inline-block;max-width:90%;color:#404040}.align-center,details{display:block}#content .keep-reading-buttons .button .header{font-size:12px;color:#767676}#content .keep-reading-buttons .button .post-title{margin-top:8px;color:#6c7d28;text-decoration:none;display:block}#content .keep-reading-buttons .button .post-title:hover,abbr[title]{text-decoration:underline}#content .keep-reading-buttons .button.next-post-button{border-right:2px solid;padding-right:10px;margin-right:-10px}#content .keep-reading-buttons .button.prev-post-button{border-left:2px solid;padding-left:10px;margin-left:-10px}#content .keep-reading-buttons .button.team-infrastructure{border-color:#E57281}#content .keep-reading-buttons .button.team-web-frontend{border-color:#63BBD9}#content .keep-reading-buttons .button.team-eng-leads{border-color:#ccc}#content .keep-reading-buttons .button.team-design{border-color:#ab59c6}.code,.codehilite{background-color:#EEE;border-radius:6px;border:1px solid #CCC;overflow-x:auto;padding:6px;margin:14px 0}.code .ln,.codehilite .ln{color:#AAA}.label{margin-top:1.5em}.caption{text-align:center}caption,table.data-table th{text-align:left}.align-center{margin-left:auto;margin-right:auto}.literal,code{word-wrap:break-word}caption{caption-side:bottom}table.data-table{margin:0 auto}table.data-table td{text-align:right}table.data-table td,table.data-table th{padding:0 5px;white-space:nowrap}[type=checkbox],[type=radio],legend{box-sizing:border-box;padding:0}.x-scrollable{overflow-x:auto}button,hr,input{overflow:visible}/*! normalize.css v8.0.0 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline dotted}b,strong{font-weight:bolder}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:ButtonText dotted 1px}fieldset{padding:.35em .75em .625em}legend{color:inherit;display:table;max-width:100%;white-space:normal}textarea{overflow:auto}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}.c,.c1,.cm,.cs,.ge{font-style:italic}.cp,.cs,.gs,.k,.kc,.kd,.kn,.kp,.kr,.kt,.nc,.ne,.nf,.o,.ow{font-weight:700}summary{display:list-item}[hidden],template{display:none}.hll{background-color:#ffc}.c{color:#998}.err{color:#a61717;background-color:#e3d2d2}.cm{color:#998}.cp{color:#999}.c1{color:#998}.cs{color:#999}.gd{color:#000;background-color:#fdd}.gr{color:#a00}.gh{color:#999}.gi{color:#000;background-color:#dfd}.go{color:#888}.gp{color:#555}.gu{color:#aaa}.gt{color:#a00}.kt{color:#458}.m{color:#099}.s{color:#b84}.na{color:teal}.nb{color:#999}.nc{color:#458}.no{color:teal}.ni{color:purple}.ne,.nf{color:#900}.nn{color:#555}.nt{color:navy}.nv{color:teal}.w{color:#bbb}.mf,.mh,.mi,.mo{color:#099}.s2,.sb,.sc,.sd,.se,.sh,.si,.sx{color:#b84}.sr{color:olive}.s1,.ss{color:#b84}.bp{color:#999}.vc,.vg,.vi{color:teal}.il{color:#099}</style>  </head> <body> <div id="left-bar"> <h1 class="logo"> <a href="/"><span aria-label="Khan Academy">KA</span> <span class="engineering">Engineering</span></a> </h1> <h1 class="logo mobile">  <a id="mobile-menu-button" href="javascript: void 0"> <svg class="font-awesome-svg" viewbox="0 0 1792 1792" aria-hidden="true"><path d="M1664 1344v128q0 26-19 45t-45 19h-1408q-26 0-45-19t-19-45v-128q0-26 19-45t45-19h1408q26 0 45 19t19 45zm0-512v128q0 26-19 45t-45 19h-1408q-26 0-45-19t-19-45v-128q0-26 19-45t45-19h1408q26 0 45 19t19 45zm0-512v128q0 26-19 45t-45 19h-1408q-26 0-45-19t-19-45v-128q0-26 19-45t45-19h1408q26 0 45 19t19 45z" fill="#fff"/></svg> <span class="text"><span aria-label="Khan Academy">KA</span> <span class="engineering">Engineering</span></span> </a> </h1> <section class="bio"> We're the engineers behind <a href="https://www.khanacademy.org">Khan Academy</a>. We're building a free, world-class education for anyone, anywhere. </section> <section class="subscription-info"> <h2 class="section-heading">Subscribe</h2> <div class="links"> <a href="https://twitter.com/KAEngineering"><span class="sr-only">Subscribe with Twitter</span><svg class="font-awesome-svg" viewbox="0 0 1792 1792" aria-hidden="true"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z" fill="#fff"/></svg></a> <a href="/rss.xml"><span class="sr-only">Subscribe with RSS</span><svg class="font-awesome-svg" viewbox="0 0 1792 1792" aria-hidden="true"><path d="M576 1344q0 80-56 136t-136 56-136-56-56-136 56-136 136-56 136 56 56 136zm512 123q2 28-17 48-18 21-47 21h-135q-25 0-43-16.5t-20-41.5q-22-229-184.5-391.5t-391.5-184.5q-25-2-41.5-20t-16.5-43v-135q0-29 21-47 17-17 43-17h5q160 13 306 80.5t259 181.5q114 113 181.5 259t80.5 306zm512 2q2 27-18 47-18 20-46 20h-143q-26 0-44.5-17.5t-19.5-42.5q-12-215-101-408.5t-231.5-336-336-231.5-408.5-102q-25-1-42.5-19.5t-17.5-43.5v-143q0-28 20-46 18-18 44-18h3q262 13 501.5 120t425.5 294q187 186 294 425.5t120 501.5z" fill="#fff"/></svg></a> </div> </section> <section> <h2 class="section-heading">Latest posts</h2> <div class="post-blurb team-infrastructure"> <h3 class="title"> <a href="/posts/original-serverless.htm">The Original Serverless Architecture is Still Here</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/kevindangoor.jpg" aria-hidden="true" role="presentation"> <a class="author-link" href="http://blueskyonmars.com/">Kevin Dangoor</a> on May 31<sup aria-hidden="true">st</sup> </div> </div> <div class="post-blurb team-infrastructure"> <h3 class="title"> <a href="/posts/architects-at-khan.htm">What do software architects at Khan Academy do?</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/kevindangoor.jpg" aria-hidden="true" role="presentation"> <a class="author-link" href="http://blueskyonmars.com/">Kevin Dangoor</a> on May 14<sup aria-hidden="true">th</sup> </div> </div> <div class="post-blurb team-infrastructure"> <h3 class="title"> <a href="/posts/khanalytics.htm">New data pipeline management platform at Khan Academy</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/ragini.jpg" aria-hidden="true" role="presentation"> <a class="author-link" href="https://github.com/guptaragini">Ragini Gupta</a> on April 30<sup aria-hidden="true">th</sup> </div> </div> <div class="post-blurb team-infrastructure"> <h3 class="title"> <a href="/posts/python-refactor-3.htm">Untangling our Python Code</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/carter.jpg" aria-hidden="true" role="presentation"> <a class="author-link" href="http://carterjbastian.com/">Carter J. Bastian</a> on April 16<sup aria-hidden="true">th</sup> </div> </div> <div class="post-blurb team-infrastructure"> <h3 class="title"> <a href="/posts/slicker.htm">Slicker: A Tool for Moving Things in Python</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/ben-kraft.png" aria-hidden="true" role="presentation"> <a class="author-link" href="http://www.benkraft.org/">Ben Kraft</a> on April 2<sup aria-hidden="true">nd</sup> </div> </div> <div class="post-blurb team-infrastructure"> <h3 class="title"> <a href="/posts/python-refactor-1.htm">The Great Python Refactor of 2017 And Also 2018</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/csilvers.png" aria-hidden="true" role="presentation"> <a class="author-link" href="https://github.com/csilvers">Craig Silverstein</a> on March 19<sup aria-hidden="true">th</sup> </div> </div> <div class="post-blurb team-web-frontend"> <h3 class="title"> <a href="/posts/working-remotely.htm">Working Remotely</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/scottgrant.png" aria-hidden="true" role="presentation"> <a class="author-link" href="https://github.com/scotchfield">Scott Grant</a> on Oct 2, 2017 </div> </div> <div class="post-blurb team-mobile"> <h3 class="title"> <a href="/posts/tips-for-code-reviews.htm">Tips for giving your first code reviews</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/hannah.jpg" aria-hidden="true" role="presentation"> <a class="author-link" href="http://hannahblumberg.com/">Hannah Blumberg</a> on Sep 18, 2017 </div> </div> <div class="post-blurb team-web-frontend"> <h3 class="title"> <a href="/posts/lets-reduce.htm">Let's Reduce! A Gentle Introduction to Javascript's Reduce Method</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/joshcomeau.jpeg" aria-hidden="true" role="presentation"> <a class="author-link" href="https://github.com/joshwcomeau">Josh Comeau</a> on Jul 10, 2017 </div> </div> <div class="post-blurb team-web-frontend"> <h3 class="title"> <a href="/posts/creating-query-components-with-apollo.htm">Creating Query Components with Apollo</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/brian-genisio.png" aria-hidden="true" role="presentation"> <a class="author-link" href="https://github.com/BrianGenisio">Brian Genisio</a> on Jun 12, 2017 </div> </div> <div class="post-blurb team-mobile"> <h3 class="title"> <a href="/posts/react-native-monorepo.htm">Migrating to a Mobile Monorepo for React Native</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/jared.jpg" aria-hidden="true" role="presentation"> <a class="author-link" href="http://jaredforsyth.com/">Jared Forsyth</a> on May 29, 2017 </div> </div> <div class="post-blurb team-infrastructure"> <h3 class="title"> <a href="/posts/memcached-fms.htm">Memcached-Backed Content Infrastructure</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/ben-kraft.png" aria-hidden="true" role="presentation"> <a class="author-link" href="http://www.benkraft.org/">Ben Kraft</a> on May 15, 2017 </div> </div> <div class="post-blurb team-infrastructure"> <h3 class="title"> <a href="/posts/memcached-profiling.htm">Profiling App Engine Memcached</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/ben-kraft.png" aria-hidden="true" role="presentation"> <a class="author-link" href="http://www.benkraft.org/">Ben Kraft</a> on May 1, 2017 </div> </div> <div class="post-blurb team-infrastructure"> <h3 class="title"> <a href="/posts/flex-language-shootout.htm">App Engine Flex Language Shootout</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/amos-latteier.jpg" aria-hidden="true" role="presentation"> <a class="author-link" href="https://github.com/latteier">Amos Latteier</a> on Apr 17, 2017 </div> </div> <div class="post-blurb team-web-frontend"> <h3 class="title"> <a href="/posts/new-oss-activity.htm">What's New in OSS at Khan Academy</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/brian-genisio.png" aria-hidden="true" role="presentation"> <a class="author-link" href="https://github.com/BrianGenisio">Brian Genisio</a> on Apr 3, 2017 </div> </div> <div class="post-blurb team-mobile"> <h3 class="title"> <a href="/posts/automating-app-store-screenshots.htm">Automating App Store Screenshots</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/bryanclark.png" aria-hidden="true" role="presentation"> <a class="author-link" href="http://www.bryanjclark.com/">Bryan Clark</a> on Mar 27, 2017 </div> </div> <div class="post-blurb team-web-frontend"> <h3 class="title"> <a href="/posts/its-okay-to-break-things.htm">It's Okay to Break Things: Reflections on Khan Academy's Healthy Hackathon</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/kimeriegreen.jpg" aria-hidden="true" role="presentation"> <a class="author-link" href="https://github.com/Kimerie">Kimerie Green</a> on Mar 6, 2017 </div> </div> <div class="post-blurb team-web-frontend"> <h3 class="title"> <a href="/posts/interning-at-khan-academy.htm">Interning at Khan Academy: from student to intern</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/shadajladdad.png" aria-hidden="true" role="presentation"> <a class="author-link" href="http://shadaj.me">Shadaj Laddad</a> on Dec 12, 2016 </div> </div> <div class="post-blurb team-web-frontend"> <h3 class="title"> <a href="/posts/prototyping-with-framer.htm">Prototyping with Framer</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/nickbreen.jpg" aria-hidden="true" role="presentation"> <a class="author-link" href="https://github.com/MrNickBreen">Nick Breen</a> on Oct 3, 2016 </div> </div> <div class="post-blurb team-infrastructure"> <h3 class="title"> <a href="/posts/evolving-our-content-infrastructure.htm">Evolving our content infrastructure</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/wchargin.png" aria-hidden="true" role="presentation"> <a class="author-link" href="https://wchargin.github.io">William Chargin</a> on Sep 19, 2016 </div> </div> <div class="post-blurb team-mobile"> <h3 class="title"> <a href="/posts/a-really-small-app.htm">Building a Really, Really Small Android App</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/charliemarsh.jpg" aria-hidden="true" role="presentation"> <a class="author-link" href="http://www.crmarsh.com">Charlie Marsh</a> on Aug 22, 2016 </div> </div> <div class="post-blurb team-web-frontend"> <h3 class="title"> <a href="/posts/a-case-for-time-tracking.htm">A Case for Time Tracking: Data Driven Time-Management</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/olivernorthwood.jpg" aria-hidden="true" role="presentation"> <a class="author-link" href="https://github.com/allofthenorthwood">Oliver Northwood</a> on Aug 8, 2016 </div> </div> <div class="post-blurb team-web-frontend"> <h3 class="title"> <a href="/posts/time-management-multiple-authors.htm">Time Management at Khan Academy</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/khanacademy.png" aria-hidden="true" role="presentation"> <a class="author-link" href="https://www.khanacademy.org/careers">Several Authors</a> on Jul 25, 2016 </div> </div> <div class="post-blurb team-eng-leads"> <h3 class="title"> <a href="/posts/healthy-hackathons.htm">Hackathons Can Be Healthy</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/tomyedwab.png" aria-hidden="true" role="presentation"> <a class="author-link" href="http://www.arguingwithalgorithms.com">Tom Yedwab</a> on Jul 11, 2016 </div> </div> <div class="post-blurb team-infrastructure"> <h3 class="title"> <a href="/posts/transaction-safety.htm">Ensuring transaction-safety in Google App Engine</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/csilvers.png" aria-hidden="true" role="presentation"> <a class="author-link" href="https://github.com/csilvers">Craig Silverstein</a> on Jun 27, 2016 </div> </div> <div class="post-blurb team-infrastructure"> <h3 class="title"> <a href="/posts/user-write-lock.htm">The User Write Lock: an Alternative to Transactions for Google App Engine</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/csilvers.png" aria-hidden="true" role="presentation"> <a class="author-link" href="https://github.com/csilvers">Craig Silverstein</a> on Jun 20, 2016 </div> </div> <div class="post-blurb team-eng-leads"> <h3 class="title"> <a href="/posts/engineering-principles.htm">Khan Academy's Engineering Principles</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/benkamens.png" aria-hidden="true" role="presentation"> <a class="author-link" href="http://bjk5.com">Ben Kamens</a> on Jun 6, 2016 </div> </div> <div class="post-blurb team-infrastructure"> <h3 class="title"> <a href="/posts/shortest-regex.htm">Minimizing the length of regular expressions, in practice</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/csilvers.png" aria-hidden="true" role="presentation"> <a class="author-link" href="https://github.com/csilvers">Craig Silverstein</a> on May 23, 2016 </div> </div> <div class="post-blurb team-mobile"> <h3 class="title"> <a href="/posts/introducing-swifttweaks.htm">Introducing SwiftTweaks</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/bryanclark.png" aria-hidden="true" role="presentation"> <a class="author-link" href="http://www.bryanjclark.com/">Bryan Clark</a> on May 9, 2016 </div> </div> <div class="post-blurb team-web-frontend"> <h3 class="title"> <a href="/posts/autonomous-dumbledore.htm">The Autonomous Dumbledore</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/evykassirer.png" aria-hidden="true" role="presentation"> <a class="author-link" href="http://www.evykassirer.com/">Evy Kassirer</a> on Apr 25, 2016 </div> </div> <div class="post-blurb team-eng-leads"> <h3 class="title"> <a href="/posts/career-development.htm">Engineering career development at Khan Academy</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/beneater.png" aria-hidden="true" role="presentation"> <a class="author-link" href="https://github.com/beneater">Ben Eater</a> on Apr 11, 2016 </div> </div> <div class="post-blurb team-infrastructure"> <h3 class="title"> <a href="/posts/aphrodite-inline-css.htm">Inline CSS at Khan Academy: Aphrodite</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/jamiewong.png" aria-hidden="true" role="presentation"> <a class="author-link" href="http://jamie-wong.com">Jamie Wong</a> on Mar 29, 2016 </div> </div> <div class="post-blurb team-mobile"> <h3 class="title"> <a href="/posts/starting-android.htm">Starting Android at Khan Academy</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/benkomalo.jpg" aria-hidden="true" role="presentation"> <a class="author-link" href="https://github.com/benkomalo">Ben Komalo</a> on Feb 29, 2016 </div> </div> <div class="post-blurb team-web-frontend"> <h3 class="title"> <a href="/posts/translation_assistant.htm">Automating Highly Similar Translations</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/kevinbarabash.png" aria-hidden="true" role="presentation"> <a class="author-link" href="https://github.com/kevinb7">Kevin Barabash</a> on Feb 15, 2016 </div> </div> <div class="post-blurb team-infrastructure"> <h3 class="title"> <a href="/posts/snippet-server.htm">The weekly snippet-server: open-sourced</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/csilvers.png" aria-hidden="true" role="presentation"> <a class="author-link" href="https://github.com/csilvers">Craig Silverstein</a> on Feb 1, 2016 </div> </div> <div class="post-blurb team-web-frontend"> <h3 class="title"> <a href="/posts/stories-from-interns.htm">Stories from our latest intern class</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/khanacademy.png" aria-hidden="true" role="presentation"> <a class="author-link" href="https://www.khanacademy.org/careers/interns">2015 Interns</a> on Dec 21, 2015 </div> </div> <div class="post-blurb team-web-frontend"> <h3 class="title"> <a href="/posts/kanbanning-learnstorm-dev-process.htm">Kanbanning the LearnStorm Dev Process</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/kevindangoor.jpg" aria-hidden="true" role="presentation"> <a class="author-link" href="http://blueskyonmars.com/">Kevin Dangoor</a> on Dec 7, 2015 </div> </div> <div class="post-blurb team-infrastructure"> <h3 class="title"> <a href="/posts/js-packaging-http2.htm">Forgo JS packaging? Not so fast</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/csilvers.png" aria-hidden="true" role="presentation"> <a class="author-link" href="https://github.com/csilvers">Craig Silverstein</a> on Nov 23, 2015 </div> </div> <div class="post-blurb team-infrastructure"> <h3 class="title"> <a href="/posts/switching-to-slack.htm">Switching to Slack</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/benjaminpollack.jpg" aria-hidden="true" role="presentation"> <a class="author-link" href="http://bitquabit.com/">Benjamin Pollack</a> on Nov 9, 2015 </div> </div> <div class="post-blurb team-infrastructure"> <h3 class="title"> <a href="/posts/receiving-feedback.htm">Receiving feedback as an intern at Khan Academy</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/davidwang.jpg" aria-hidden="true" role="presentation"> <a class="author-link" href="http://ourracingthoughts.com/author/d15w/">David Wang</a> on Oct 26, 2015 </div> </div> <div class="post-blurb team-infrastructure"> <h3 class="title"> <a href="/posts/translation-server.htm">Schrödinger's deploys no more: how we update translations</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/chelseavoss.png" aria-hidden="true" role="presentation"> <a class="author-link" href="http://csvoss.github.io/">Chelsea Voss</a> on Oct 12, 2015 </div> </div> <div class="post-blurb team-infrastructure"> <h3 class="title"> <a href="/posts/i18nize-templates.htm">i18nize-templates: Internationalization After the Fact</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/csilvers.png" aria-hidden="true" role="presentation"> <a class="author-link" href="https://github.com/csilvers">Craig Silverstein</a> on Sep 28, 2015 </div> </div> <div class="post-blurb team-web-frontend"> <h3 class="title"> <a href="/posts/making-thumbnails-fast.htm">Making thumbnails fast</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/wchargin.png" aria-hidden="true" role="presentation"> <a class="author-link" href="https://wchargin.github.io">William Chargin</a> on Sep 14, 2015 </div> </div> <div class="post-blurb team-web-frontend"> <h3 class="title"> <a href="/posts/copy-pasting-more-than-just-text.htm">Copy-pasting more than just text</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/samlau.jpg" aria-hidden="true" role="presentation"> <a class="author-link" href="https://github.com/SamLau95">Sam Lau</a> on Aug 31, 2015 </div> </div> <div class="post-blurb team-web-frontend"> <h3 class="title"> <a href="/posts/no-cheating-allowed.htm">No cheating allowed!!</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/philliplemons.png" aria-hidden="true" role="presentation"> <a class="author-link" href="http://philliplemons.com/">Phillip Lemons</a> on Aug 17, 2015 </div> </div> <div class="post-blurb team-design"> <h3 class="title"> <a href="/posts/fun-with-slopfields.htm">Fun with slope fields, css and react</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/marcosojeda.jpg" aria-hidden="true" role="presentation"> <a class="author-link" href="http://generic.cx/">Marcos Ojeda</a> on Aug 5, 2015 </div> </div> <div class="post-blurb team-web-frontend"> <h3 class="title"> <a href="/posts/new-employees-primer.htm">Khan Academy: a new employee's primer</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/rileyshaw.png" aria-hidden="true" role="presentation"> <a class="author-link" href="http://rileyjshaw.com">Riley Shaw</a> on Jul 20, 2015 </div> </div> <div class="post-blurb team-web-frontend"> <h3 class="title"> <a href="/posts/evil-puzzle.htm">How wooden puzzles can destroy dev teams</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/johnsullivan.png" aria-hidden="true" role="presentation"> <a class="author-link" href="https://github.com/brownhead">John Sullivan</a> on Jul 6, 2015 </div> </div> <div class="post-blurb team-web-frontend"> <h3 class="title"> <a href="/posts/i18n-babel-plugin.htm">Babel in Khan Academy's i18n Toolchain</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/kevinbarabash.png" aria-hidden="true" role="presentation"> <a class="author-link" href="https://github.com/kevinb7">Kevin Barabash</a> on Jun 22, 2015 </div> </div> <div class="post-blurb team-web-frontend"> <h3 class="title"> <a href="/posts/tota11y.htm">tota11y - an accessibility visualization toolkit</a> </h3> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/jordanscales.png" aria-hidden="true" role="presentation"> <a class="author-link" href="https://github.com/jdan">Jordan Scales</a> on Jun 8, 2015 </div> </div> </section> <section class="meta-section"> <h2 class="section-heading">Meta</h2> <ul class="link-list"> <li><a href="https://github.com/Khan/engblog">About this blog</a></li> <li><a href="https://www.khanacademy.org/about">KA's mission</a></li> <li><a href="https://github.com/khan/engblog/issues">Report a bug</a></li> <li><a id="activate-tota11y" href="javascript: void 0">Activate tota11y</a></li> </ul> </section> </div> <main id="content"> <article class="post"> <h1 class="title"> <a href="/posts/creating-query-components-with-apollo.htm"> Creating Query Components with Apollo </a> </h1> <div class="info"> <img class="inline-author-photo" src="/images/author-icons/brian-genisio.png" aria-hidden="true" role="presentation"> <span class="sr-only">by</span> <a class="author-link" href="https://github.com/BrianGenisio">Brian Genisio</a> on Jun 12, 2017 </div> <div class="body"> <p>Here at Khan Academy, we've been using <a href="http://graphql.org/">GraphQL</a> in several projects with great success. GraphQL is a query language for describing the data you want from the backend API. It is an elegant solution to some of the problems that REST presents, including client performance.</p> <p>Prevailing wisdom in the React/GraphQL space these days suggests that queries be co-located with the components which use them. We use <a href="http://dev.apollodata.com/">Apollo</a> as our client abstraction to the GraphQL endpoint such that co-located queries are relatively straightforward to structure, at least for simple cases. </p> <p>As queries and component interactions become more complicated, however, the presentation and query layers become intertwined in a way that can feel overwhelming, especially from a <a href="https://en.wikipedia.org/wiki/Separation_of_concerns">separation of concerns</a> perspective. Because of this, we've started to adopt a pattern we are calling "Query Components". I'll explain in more detail later in this post, but a Query Component is a component which abstracts the data definition from the <a href="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0">Presentational Component</a>, allowing the Presentational Component to be agnostic of Apollo or GraphQL.</p> <h2>Demo code</h2> <p>All of the demo code for this post can be found in this <a href="https://github.com/BrianGenisio/schools">Schools</a> repo. You can play with it <a href="http://briangenisio.com/schools/">live</a> if you'd like. There is not a ton of data, but it is an example of searching for schools by postal code. Some postal codes with data include 48103, 48104, and 48105. </p> <p>It uses <a href="https://www.graph.cool/">GraphCool</a> as the backend GraphQL implementation. GraphCool is a really great way to experiment with GraphQL without learning how to implement a GraphQL server. It is a Backend as a Service (BaaS) for implementing a data store with a GraphQL interface.</p> <h2>A simple example</h2> <p>Let's start with a simple example of using Apollo to connect a GraphQL query to a React component. Here is a Presentational Component which displays a list of all the schools available and a "Loading" string while we are waiting. It is purposefully simple and shows how you can describe the data you want and display it with very little ceremony.</p> <div class="codehilite"><pre><span class="kn">import</span> <span class="nn">React</span><span class="o">,</span> <span class="p">{</span><span class="n">Component</span><span class="p">}</span> <span class="kn">from</span> <span class="s">&#39;react&#39;</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span><span class="n">graphql</span><span class="p">}</span> <span class="kn">from</span> <span class="s">&#39;react-apollo&#39;</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">gql</span> <span class="nn">from</span> <span class="s">&#39;graphql-tag&#39;</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Schools</span> <span class="n">extends</span> <span class="n">Component</span> <span class="p">{</span>
    <span class="n">render</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loading</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span><span class="n">Loading</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
        <span class="p">{</span>
            <span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">allSchools</span><span class="o">.</span><span class="n">map</span><span class="p">((</span><span class="n">school</span><span class="p">)</span> <span class="o">=&gt;</span>
                <span class="o">&lt;</span><span class="n">li</span> <span class="n">key</span><span class="o">=</span><span class="p">{</span><span class="n">school</span><span class="o">.</span><span class="n">id</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="n">school</span><span class="o">.</span><span class="n">display</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
        <span class="p">)}</span>
        <span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">const</span> <span class="n">SCHOOLS_QUERY</span> <span class="o">=</span> <span class="n">gql</span><span class="err">`</span><span class="n">query</span> <span class="n">allSchools</span> <span class="p">{</span>
  <span class="n">allSchools</span><span class="p">(</span><span class="n">orderBy</span><span class="p">:</span> <span class="n">display_ASC</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">id</span>
    <span class="n">postalCode</span>
    <span class="n">display</span>
  <span class="p">}</span>
<span class="p">}</span><span class="err">`</span><span class="p">;</span>

<span class="n">export</span> <span class="n">default</span> <span class="n">graphql</span><span class="p">(</span><span class="n">SCHOOLS_QUERY</span><span class="p">)(</span><span class="n">Schools</span><span class="p">);</span>
</pre></div> <h2>A more complicated example</h2> <p>Unfortunately, simple examples like the one above are not the common case in practice. Let's see how this expands to be more like what you'd see in a real application.</p> <ol> <li> <p>We'd like to pass a parameter to the component in order to filter the query by postal code.</p> </li> <li> <p>In addition to the <code>data.loading</code> flag, we'd like to know when there was an error and we'd like to know when the query was successful but the result was empty.</p> </li> <li> <p>We'd like to use <a href="https://flow.org/">Flow</a> types, so we'll annotate all the types in this component.</p> </li> <li> <p>We'd like to include <a href="https://facebook.github.io/react/docs/typechecking-with-proptypes.html">PropTypes</a> in the component. Since we are using Flow we'll do so via <a href="https://www.npmjs.com/package/babel-plugin-flow-react-proptypes">Flow -&gt; React PropTypes</a>.</p> </li> </ol> <div class="codehilite"><pre><span class="o">//</span> <span class="nd">@flow</span>

<span class="kn">import</span> <span class="nn">React</span><span class="o">,</span> <span class="p">{</span><span class="n">Component</span><span class="p">}</span> <span class="kn">from</span> <span class="s">&#39;react&#39;</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span><span class="n">graphql</span><span class="p">}</span> <span class="kn">from</span> <span class="s">&#39;react-apollo&#39;</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">gql</span> <span class="nn">from</span> <span class="s">&#39;graphql-tag&#39;</span><span class="p">;</span>

<span class="nb">type</span> <span class="n">School</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nb">id</span><span class="p">:</span> <span class="n">string</span><span class="p">,</span>
    <span class="n">postalCode</span><span class="p">:</span> <span class="n">string</span><span class="p">,</span>
    <span class="n">display</span><span class="p">:</span> <span class="n">string</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Schools</span> <span class="n">extends</span> <span class="n">Component</span> <span class="p">{</span>
    <span class="n">props</span><span class="p">:</span> <span class="p">{</span>
        <span class="o">//</span> <span class="n">Provided</span> <span class="n">by</span> <span class="n">the</span> <span class="n">parent</span> <span class="n">component</span>
        <span class="n">postalCode</span><span class="p">:</span> <span class="n">string</span><span class="p">,</span>

        <span class="o">//</span> <span class="n">provided</span> <span class="n">by</span> <span class="n">the</span> <span class="n">Apollo</span> <span class="n">wrapper</span>
        <span class="n">schools</span><span class="p">:</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">School</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="n">isLoading</span><span class="p">:</span> <span class="n">boolean</span><span class="p">,</span>
        <span class="n">isEmpty</span><span class="p">:</span> <span class="n">boolean</span><span class="p">,</span>
        <span class="n">isError</span><span class="p">:</span> <span class="n">boolean</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">render</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">const</span> <span class="p">{</span><span class="n">schools</span><span class="p">,</span> <span class="n">isLoading</span><span class="p">,</span> <span class="n">isEmpty</span><span class="p">,</span> <span class="n">isError</span><span class="p">}</span> <span class="o">=</span> <span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">isLoading</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span><span class="n">Loading</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">isEmpty</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span><span class="n">No</span> <span class="n">items</span> <span class="n">match</span> <span class="n">your</span> <span class="n">postal</span> <span class="n">code</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">isError</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span><span class="n">There</span> <span class="n">was</span> <span class="n">an</span> <span class="n">error</span> <span class="n">processing</span> <span class="n">your</span> <span class="n">search</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span><span class="p">{</span>
            <span class="n">schools</span><span class="o">.</span><span class="n">map</span><span class="p">((</span><span class="n">school</span><span class="p">)</span> <span class="o">=&gt;</span>
                <span class="o">&lt;</span><span class="n">li</span> <span class="n">key</span><span class="o">=</span><span class="p">{</span><span class="n">school</span><span class="o">.</span><span class="n">id</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="n">school</span><span class="o">.</span><span class="n">display</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
            <span class="p">)</span>
        <span class="p">}</span><span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">const</span> <span class="n">SCHOOLS_QUERY</span> <span class="o">=</span> <span class="n">gql</span><span class="err">`</span><span class="n">query</span> <span class="n">allSchools</span><span class="p">(</span><span class="err">$</span><span class="n">postalCode</span><span class="p">:</span> <span class="n">String</span><span class="err">!</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">allSchools</span><span class="p">(</span>
      <span class="n">orderBy</span><span class="p">:</span> <span class="n">display_ASC</span><span class="p">,</span>
      <span class="nb">filter</span><span class="p">:</span> <span class="p">{</span><span class="n">postalCode</span><span class="p">:</span> <span class="err">$</span><span class="n">postalCode</span><span class="p">}</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="nb">id</span>
    <span class="n">postalCode</span>
    <span class="n">display</span>
  <span class="p">}</span>
<span class="p">}</span><span class="err">`</span><span class="p">;</span>

<span class="nb">type</span> <span class="n">SchoolsData</span> <span class="o">=</span>  <span class="p">{</span>
    <span class="n">loading</span><span class="p">:</span> <span class="n">boolean</span><span class="p">,</span>
    <span class="n">error</span><span class="p">:</span> <span class="n">string</span><span class="p">,</span>
    <span class="n">allSchools</span><span class="err">?</span><span class="p">:</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">School</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">};</span>

<span class="n">const</span> <span class="n">mapDataToProps</span> <span class="o">=</span> <span class="p">({</span><span class="n">data</span><span class="p">}:</span> <span class="p">{</span><span class="n">data</span><span class="p">:</span> <span class="n">SchoolsData</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="n">const</span> <span class="n">isLoading</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loading</span><span class="p">;</span>
    <span class="n">const</span> <span class="n">isEmpty</span> <span class="o">=</span> <span class="err">!!</span><span class="n">data</span><span class="o">.</span><span class="n">allSchools</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="o">.</span><span class="n">allSchools</span><span class="o">.</span><span class="n">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">const</span> <span class="n">isError</span> <span class="o">=</span> <span class="err">!!</span><span class="n">data</span><span class="o">.</span><span class="n">error</span><span class="p">;</span>
    <span class="n">const</span> <span class="n">schools</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">allSchools</span> <span class="o">||</span> <span class="p">[];</span>

    <span class="k">return</span> <span class="p">{</span><span class="n">isLoading</span><span class="p">,</span> <span class="n">isEmpty</span><span class="p">,</span> <span class="n">isError</span><span class="p">,</span> <span class="n">schools</span><span class="p">};</span>
<span class="p">};</span>

<span class="n">const</span> <span class="n">mapPropsToOptions</span> <span class="o">=</span> <span class="p">({</span><span class="n">postalCode</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">({</span><span class="n">variables</span><span class="p">:</span> <span class="p">{</span><span class="n">postalCode</span><span class="p">}});</span>

<span class="n">export</span> <span class="n">default</span> <span class="n">graphql</span><span class="p">(</span><span class="n">SCHOOLS_QUERY</span><span class="p">,</span> <span class="p">{</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">mapPropsToOptions</span><span class="p">,</span>
    <span class="n">props</span><span class="p">:</span> <span class="n">mapDataToProps</span><span class="p">,</span>
<span class="p">})(</span><span class="n">Schools</span><span class="p">);</span>
</pre></div> <p>Now that we've added these features, we have a new set of problems.</p> <ol> <li> <p>The original code violates the "separation of concern" principle but this code is more egregious. This component is managing the GraphQL/Apollo integration and the presentation at the same time.</p> </li> <li> <p>The properties of the component don't properly communicate the intended usage. The parent needs to provide the <code>postalCode</code> property, but the other required properties (<code>schools</code>, <code>isLoading</code>, <code>isEmpty</code>, and <code>isError</code>) are provided by the <code>mapDataToProps</code> function.</p> </li> <li> <p>The actual presentation is tightly coupled to the query and glue logic. It is not uncommon for the same query to be used for a select component, or a table layout, or some other presentation. Providing a different presentation isn't immediately obvious.</p> </li> </ol> <h2>Query Components</h2> <p>A pattern we've liked using lately is something we are calling "Query Components". Query Components encapsulate the query and Apollo glue logic into one component, which allows it to be composed with a separated Presentational Component.</p> <p>It uses the <a href="https://facebook.github.io/react/docs/jsx-in-depth.html#functions-as-children">"Functions as Children"</a> pattern. For more information on this pattern, see Merrick Christensen's writeup in <a href="https://medium.com/merrickchristensen/function-as-child-components-5f3920a9ace9">Function as Child Components</a>. </p> <h3>SchoolsQuery</h3> <p>This is a Query Component which encapsulates all of the GraphQL query and the Apollo glue logic. It doesn't have any presentation.</p> <div class="codehilite"><pre><span class="o">//</span> <span class="nd">@flow</span>
<span class="kn">import</span> <span class="nn">gql</span> <span class="nn">from</span> <span class="s">&#39;graphql-tag&#39;</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span><span class="n">Component</span><span class="p">}</span> <span class="kn">from</span> <span class="s">&#39;react&#39;</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span><span class="n">graphql</span><span class="p">}</span> <span class="kn">from</span> <span class="s">&#39;react-apollo&#39;</span><span class="p">;</span>

<span class="n">export</span> <span class="nb">type</span> <span class="n">School</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nb">id</span><span class="p">:</span> <span class="n">string</span><span class="p">,</span>
    <span class="n">postalCode</span><span class="p">:</span> <span class="n">string</span><span class="p">,</span>
    <span class="n">display</span><span class="p">:</span> <span class="n">string</span><span class="p">,</span>
<span class="p">}</span>

<span class="nb">type</span> <span class="n">SchoolQueryChildrenFn</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">schools</span><span class="p">:</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">School</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">details</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">isLoading</span><span class="p">:</span> <span class="n">boolean</span><span class="p">,</span>
        <span class="n">isEmpty</span><span class="p">:</span> <span class="n">boolean</span><span class="p">,</span>
        <span class="n">isError</span><span class="p">:</span> <span class="n">boolean</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span> <span class="o">=&gt;</span> <span class="n">React</span><span class="err">$</span><span class="n">Element</span><span class="o">&lt;</span><span class="nb">any</span><span class="o">&gt;</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SchoolsQuery</span> <span class="n">extends</span> <span class="n">Component</span> <span class="p">{</span>
    <span class="n">props</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">postalCode</span><span class="p">:</span> <span class="n">string</span><span class="p">,</span>
        <span class="n">children</span><span class="err">?</span><span class="p">:</span> <span class="n">SchoolQueryChildrenFn</span><span class="p">,</span>

        <span class="n">isLoading</span><span class="p">:</span> <span class="n">boolean</span><span class="p">,</span>
        <span class="n">isEmpty</span><span class="p">:</span> <span class="n">boolean</span><span class="p">,</span>
        <span class="n">isError</span><span class="p">:</span> <span class="n">boolean</span><span class="p">,</span>
        <span class="n">schools</span><span class="p">:</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">School</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">static</span> <span class="n">defaultProps</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">isLoading</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
        <span class="n">isEmpty</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
        <span class="n">isError</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
        <span class="n">schools</span><span class="p">:</span> <span class="p">[],</span>
    <span class="p">}</span>

    <span class="n">render</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">const</span> <span class="p">{</span><span class="n">isLoading</span><span class="p">,</span> <span class="n">isEmpty</span><span class="p">,</span> <span class="n">isError</span><span class="p">,</span> <span class="n">schools</span><span class="p">,</span> <span class="n">children</span><span class="p">}</span> <span class="o">=</span> <span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="p">;</span>

        <span class="k">return</span> <span class="n">children</span> <span class="o">&amp;&amp;</span> <span class="n">children</span><span class="p">(</span><span class="n">schools</span><span class="p">,</span> <span class="p">{</span><span class="n">isLoading</span><span class="p">,</span> <span class="n">isEmpty</span><span class="p">,</span> <span class="n">isError</span><span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">const</span> <span class="n">SCHOOLS_QUERY</span> <span class="o">=</span> <span class="n">gql</span><span class="err">`</span><span class="n">query</span> <span class="n">allSchools</span><span class="p">(</span><span class="err">$</span><span class="n">postalCode</span><span class="p">:</span> <span class="n">String</span><span class="err">!</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">allSchools</span><span class="p">(</span>
      <span class="n">orderBy</span><span class="p">:</span> <span class="n">display_ASC</span><span class="p">,</span>
      <span class="nb">filter</span><span class="p">:</span> <span class="p">{</span><span class="n">postalCode</span><span class="p">:</span> <span class="err">$</span><span class="n">postalCode</span><span class="p">}</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="nb">id</span>
    <span class="n">postalCode</span>
    <span class="n">display</span>
  <span class="p">}</span>
<span class="p">}</span><span class="err">`</span><span class="p">;</span>

<span class="nb">type</span> <span class="n">SchoolsData</span> <span class="o">=</span>  <span class="p">{</span>
    <span class="n">loading</span><span class="p">:</span> <span class="n">boolean</span><span class="p">,</span>
    <span class="n">error</span><span class="p">:</span> <span class="n">string</span><span class="p">,</span>
    <span class="n">allSchools</span><span class="err">?</span><span class="p">:</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">School</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">};</span>

<span class="n">const</span> <span class="n">mapDataToProps</span> <span class="o">=</span> <span class="p">({</span><span class="n">data</span><span class="p">}:</span> <span class="p">{</span><span class="n">data</span><span class="p">:</span> <span class="n">SchoolsData</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="n">const</span> <span class="n">isLoading</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loading</span><span class="p">;</span>
    <span class="n">const</span> <span class="n">isEmpty</span> <span class="o">=</span> <span class="err">!!</span><span class="n">data</span><span class="o">.</span><span class="n">allSchools</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="o">.</span><span class="n">allSchools</span><span class="o">.</span><span class="n">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">const</span> <span class="n">isError</span> <span class="o">=</span> <span class="err">!!</span><span class="n">data</span><span class="o">.</span><span class="n">error</span><span class="p">;</span>
    <span class="n">const</span> <span class="n">schools</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">allSchools</span> <span class="o">||</span> <span class="p">[];</span>

    <span class="k">return</span> <span class="p">{</span><span class="n">isLoading</span><span class="p">,</span> <span class="n">isEmpty</span><span class="p">,</span> <span class="n">isError</span><span class="p">,</span> <span class="n">schools</span><span class="p">};</span>
<span class="p">};</span>

<span class="n">const</span> <span class="n">mapPropsToOptions</span> <span class="o">=</span> <span class="p">({</span><span class="n">postalCode</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">({</span><span class="n">variables</span><span class="p">:</span> <span class="p">{</span><span class="n">postalCode</span><span class="p">}});</span>

<span class="n">export</span> <span class="n">default</span> <span class="n">graphql</span><span class="p">(</span><span class="n">SCHOOLS_QUERY</span><span class="p">,</span> <span class="p">{</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">mapPropsToOptions</span><span class="p">,</span>
    <span class="n">props</span><span class="p">:</span> <span class="n">mapDataToProps</span><span class="p">,</span>
<span class="p">})(</span><span class="n">SchoolsQuery</span><span class="p">);</span>
</pre></div> <h3>Schools component</h3> <p>This is a Presentational Component which composes itself with the Query Component and the presentation. The interface is clear and the presentation is simple.</p> <div class="codehilite"><pre><span class="o">//</span> <span class="nd">@flow</span>

<span class="kn">import</span> <span class="nn">React</span><span class="o">,</span> <span class="p">{</span><span class="n">Component</span><span class="p">}</span> <span class="kn">from</span> <span class="s">&quot;react&quot;</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">SchoolsQuery</span> <span class="nn">from</span> <span class="s">&quot;./SchoolsQuery.js&quot;</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Schools</span> <span class="n">extends</span> <span class="n">Component</span> <span class="p">{</span>
    <span class="n">props</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">postalCode</span><span class="p">:</span> <span class="n">string</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">render</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">const</span> <span class="p">{</span><span class="n">postalCode</span><span class="p">}</span> <span class="o">=</span> <span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="p">;</span>

        <span class="k">return</span> <span class="o">&lt;</span><span class="n">SchoolsQuery</span> <span class="n">postalCode</span><span class="o">=</span><span class="p">{</span><span class="n">postalCode</span><span class="p">}</span><span class="o">&gt;</span>
            <span class="p">{(</span><span class="n">schools</span><span class="p">,</span> <span class="p">{</span><span class="n">isLoading</span><span class="p">,</span> <span class="n">isEmpty</span><span class="p">,</span> <span class="n">isError</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">isLoading</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span><span class="n">Loading</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">isEmpty</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span><span class="n">No</span> <span class="n">items</span> <span class="n">match</span> <span class="n">your</span> <span class="n">postal</span> <span class="n">code</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">isError</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span><span class="n">There</span> <span class="n">was</span> <span class="n">an</span> <span class="n">error</span> <span class="n">processing</span> <span class="n">your</span> <span class="n">search</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">return</span> <span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span><span class="p">{</span>
                    <span class="n">schools</span><span class="o">.</span><span class="n">map</span><span class="p">((</span><span class="n">school</span><span class="p">)</span> <span class="o">=&gt;</span>
                        <span class="o">&lt;</span><span class="n">li</span> <span class="n">key</span><span class="o">=</span><span class="p">{</span><span class="n">school</span><span class="o">.</span><span class="n">id</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="n">school</span><span class="o">.</span><span class="n">display</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
                    <span class="p">)</span>
                <span class="p">}</span><span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span><span class="p">;</span>
            <span class="p">}}</span>
        <span class="o">&lt;/</span><span class="n">SchoolsQuery</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">export</span> <span class="n">default</span> <span class="n">Schools</span><span class="p">;</span>
</pre></div> <h2>Going forward</h2> <p>Query Components have been a valuable pattern within our codebase, but they are new to us, and we are still evaluating how the pattern will scale over time. I expect an abstraction which codifies the pattern will be valuable. I'd also like to see how the same concept can be used for other API interfaces. The same approach would work for more traditional REST interfaces, for example. Whatever the case, I expect that we will be blogging more about GraphQL in the future.</p> <h2>Bonus!</h2> <p>This pattern can be applied to GraphQL mutations as well. By separating the mutation into a Mutation Component, the presentation only needs to activate the mutation. For the sake of brevity, I won't include the implementation here, but you can find it in the <a href="https://github.com/BrianGenisio/schools/blob/master/src/NewSchoolMutation.js">demo code</a>.</p> <p>You can compose the Mutation Component with the presentation like this:</p> <div class="codehilite"><pre><span class="nt">&lt;NewSchoolMutation</span>
    <span class="na">postalCode=</span><span class="s">{postalCode}</span>
    <span class="na">display=</span><span class="s">{display}</span>
<span class="nt">&gt;</span>
    {triggerMutation =&gt; <span class="nt">&lt;button</span> <span class="na">onClick=</span><span class="s">{triggerMutation}</span><span class="nt">&gt;</span>
        Create!    
    <span class="nt">&lt;/button&gt;</span>}
<span class="nt">&lt;/NewSchoolMutation&gt;</span>
</pre></div> </div> </article> <div class="keep-reading-buttons"> <div class="keep-reading-cell keep-reading-left"> <div class="button prev-post-button team-mobile"> <div class="header">previous post</div> <a href="/posts/react-native-monorepo.htm" class="post-title">Migrating to a Mobile Monorepo for React Native</a> </div> </div> <div class="keep-reading-cell keep-reading-right"> <div class="button next-post-button team-web-frontend"> <div class="header">next post</div> <a href="/posts/lets-reduce.htm" class="post-title">Let's Reduce! A Gentle Introduction to Javascript's Reduce Method</a> </div> </div> </div> </main> <script>document.getElementById("mobile-menu-button").onclick=function(){var e=document.body,t=document.getElementById("left-bar"),a=document.getElementById("content");"mobile-visible"===t.className?(e.className="",t.className="",a.className=""):(e.className="mobile-menu-visible",t.className="mobile-visible",a.className="mobile-hidden")};var totallyActivated=!1;document.getElementById("activate-tota11y").onclick=function(){if(totallyActivated)console.log("Tota11y already activated. Doing nothing.");else{var e=document.createElement("script");e.src="/javascript/tota11y.min.js",document.head.appendChild(e),totallyActivated=!0}},function(e,t,a,n,c,l,o){e.GoogleAnalyticsObject=c,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,l=t.createElement(a),o=t.getElementsByTagName(a)[0],l.async=1,l.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(l,o)}(window,document,"script",0,"ga"),ga("create","UA-65856931-1","auto"),ga("send","pageview");</script> </body> </html> 